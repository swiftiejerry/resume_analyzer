<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 智能简历分析系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>

<body class="text-gray-800 antialiased p-6 md:p-12">

    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-12 animate-fade-in">
            <h1
                class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-500 to-blue-600 mb-4 tracking-tight">
                AI 智能简历分析</h1>
            <p class="text-gray-600 text-lg">一键解析、精准提取、智能匹配，提升招聘效率</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Left Column: Upload & Form -->
            <div class="space-y-6">
                <!-- Step 1: Upload Resume -->
                <div class="glass-panel p-6 rounded-2xl animate-fade-in" style="animation-delay: 0.1s;">
                    <h2 class="text-xl font-bold mb-4 flex items-center text-teal-700">
                        <span
                            class="bg-teal-100 text-teal-700 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">1</span>
                        上传简历 (PDF)
                    </h2>

                    <div class="border-2 border-dashed border-teal-300 rounded-xl p-8 text-center bg-white/50 hover:bg-white/80 transition cursor-pointer group relative"
                        id="drop-area">
                        <input type="file" id="resume-file" accept=".pdf"
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                        <svg class="mx-auto h-12 w-12 text-teal-400 group-hover:text-teal-600 transition"
                            stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                            <path
                                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p class="mt-2 text-sm text-gray-600">点击上传或将 PDF 拖拽至此</p>
                        <p id="file-name" class="mt-1 text-xs text-teal-600 font-semibold hidden"></p>
                    </div>

                    <button id="analyze-btn"
                        class="mt-4 w-full bg-gradient-to-r from-teal-500 to-emerald-500 text-white font-semibold py-3 px-4 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        开始解析
                    </button>
                    <!-- Loader -->
                    <div id="analyze-loader" class="hidden mt-3 text-center">
                        <div
                            class="inline-block w-6 h-6 border-4 border-teal-500 border-t-transparent rounded-full animate-spin">
                        </div>
                        <span class="ml-2 text-sm text-teal-600 font-medium">AI 正在深度分析简历，请稍候...</span>
                    </div>
                </div>

                <!-- Step 2: Job Description Matching -->
                <div class="glass-panel p-6 rounded-2xl animate-fade-in" style="animation-delay: 0.2s;">
                    <h2 class="text-xl font-bold mb-4 flex items-center text-blue-700">
                        <span
                            class="bg-blue-100 text-blue-700 rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm">2</span>
                        岗位配置与匹配
                    </h2>

                    <textarea id="job-desc" rows="4"
                        class="w-full rounded-xl border-gray-200 outline-none focus:ring-2 focus:ring-blue-400 p-4 text-sm resize-none bg-white/70"
                        placeholder="请输入目标岗位的详细职责与要求..."></textarea>

                    <button id="match-btn" disabled
                        class="mt-4 w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold py-3 px-4 rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none">
                        智能匹配评分
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </button>

                    <!-- Loader -->
                    <div id="match-loader" class="hidden mt-3 text-center">
                        <div
                            class="inline-block w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full animate-spin">
                        </div>
                        <span class="ml-2 text-sm text-blue-600 font-medium">AI 正在进行岗位匹配评估...</span>
                    </div>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="space-y-6">
                <!-- Resume Result -->
                <div id="resume-result"
                    class="glass-panel p-6 rounded-2xl hidden animate-fade-in h-auto flex-col border-t-4 border-t-teal-400">
                    <h3 class="text-lg font-bold text-gray-800 border-b pb-2 mb-4">解析结果摘要</h3>

                    <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                        <div>
                            <p class="text-gray-500 text-xs">候选人姓名</p>
                            <p class="font-semibold text-gray-800" id="res-name">-</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">联系电话</p>
                            <p class="font-semibold text-gray-800" id="res-phone">-</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">电子邮件</p>
                            <p class="font-semibold text-gray-800" id="res-email">-</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">最高学历</p>
                            <p class="font-semibold text-gray-800" id="res-edu">-</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">工作年限</p>
                            <p class="font-semibold text-gray-800" id="res-exp">-</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">求职意向</p>
                            <p class="font-semibold text-gray-800" id="res-intent">-</p>
                        </div>
                    </div>

                    <div class="bg-teal-50 rounded-lg p-4 text-sm">
                        <p class="font-semibold text-teal-800 mb-1">AI 核心技能提炼:</p>
                        <p class="text-teal-700 leading-relaxed" id="res-summary">-</p>
                    </div>
                </div>

                <!-- Match Result -->
                <div id="match-result"
                    class="glass-panel p-6 rounded-2xl hidden animate-fade-in h-auto border-t-4 border-t-blue-500">
                    <h3 class="text-lg font-bold text-gray-800 border-b pb-2 mb-4 flex justify-between items-center">
                        岗位匹配报告
                        <div
                            class="text-center w-16 h-16 rounded-full border-4 border-blue-500 flex items-center justify-center bg-white shadow-inner">
                            <span id="match-score" class="text-2xl font-black text-blue-600">0</span>
                        </div>
                    </h3>

                    <div class="space-y-4 text-sm">
                        <div>
                            <p class="font-semibold text-gray-700 mb-1 flex items-center">
                                <svg class="w-4 h-4 mr-1 text-green-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                技能匹配分析
                            </p>
                            <p class="text-gray-600 bg-white/60 p-3 rounded-lg border border-gray-100"
                                id="match-skills">-</p>
                        </div>
                        <div>
                            <p class="font-semibold text-gray-700 mb-1 flex items-center">
                                <svg class="w-4 h-4 mr-1 text-yellow-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                经验相关性
                            </p>
                            <p class="text-gray-600 bg-white/60 p-3 rounded-lg border border-gray-100" id="match-exp">-
                            </p>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-3">
                            <p class="font-semibold text-blue-800 mb-1">综合短评:</p>
                            <p class="text-blue-700 italic" id="match-comment">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div id="toast"
        class="fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-xl shadow-2xl transform transition-all duration-300 translate-y-20 opacity-0 z-50 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span id="toast-msg">Error</span>
    </div>

    <script>
        // --- DEPLOYMENT CONFIGURATION ---
        // If deploying to GitHub Pages, change this to your deployed Alibaba Cloud API URL
        // Example: const API_BASE = 'https://your-custom-domain.cn-hangzhou.fcapp.run/api/resume';
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? '/api/resume'
            : 'https://REPLACE_WITH_YOUR_ALIYUN_FC_URL/api/resume';

        let currentResumeId = null;

        const fileInput = document.getElementById('resume-file');
        const fileName = document.getElementById('file-name');
        const analyzeBtn = document.getElementById('analyze-btn');
        const matchBtn = document.getElementById('match-btn');
        const jobDescInput = document.getElementById('job-desc');

        // Show file name
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileName.textContent = "已选择: " + e.target.files[0].name;
                fileName.classList.remove('hidden');
            }
        });

        // Toast
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').textContent = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 4000);
        }

        // Analyze logic
        analyzeBtn.addEventListener('click', async () => {
            if (!fileInput.files.length) {
                showToast("请先选择 PDF 简历文件");
                return;
            }
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append("file", file);

            // UI loading state
            analyzeBtn.classList.add('hidden');
            document.getElementById('analyze-loader').classList.remove('hidden');
            document.getElementById('resume-result').classList.add('hidden');
            document.getElementById('match-result').classList.add('hidden');
            matchBtn.disabled = true;

            try {
                // Determine API endpoint depending on how it's hosted
                // If static HTML is served via FastAPI, empty string base is fine
                const res = await fetch(`${API_BASE}/analyze`, {
                    method: 'POST',
                    body: formData
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.detail || "解析失败");

                // Populate UI
                currentResumeId = data.resume_id;
                const rd = data.data;
                document.getElementById('res-name').textContent = rd.basic_info.name || '未提供';
                document.getElementById('res-phone').textContent = rd.basic_info.phone || '未提供';
                document.getElementById('res-email').textContent = rd.basic_info.email || '未提供';
                document.getElementById('res-edu').textContent = rd.education_background || '未提供';
                document.getElementById('res-exp').textContent = rd.work_years || '未提供';
                document.getElementById('res-intent').textContent = rd.job_intention || '未提供';
                document.getElementById('res-summary').textContent = rd.raw_text_summary || '未提供';

                document.getElementById('resume-result').classList.remove('hidden');

                // Enable match button if job description is present
                matchBtn.disabled = false;

            } catch (err) {
                showToast(err.message);
            } finally {
                analyzeBtn.classList.remove('hidden');
                document.getElementById('analyze-loader').classList.add('hidden');
            }
        });

        // Match Logic
        matchBtn.addEventListener('click', async () => {
            const jobDesc = jobDescInput.value.trim();
            if (!jobDesc) {
                showToast("请填写目标岗位职责描述");
                return;
            }
            if (!currentResumeId) {
                showToast("请先等简历提取完成");
                return;
            }

            matchBtn.classList.add('hidden');
            document.getElementById('match-loader').classList.remove('hidden');
            document.getElementById('match-result').classList.add('hidden');

            try {
                const res = await fetch(`${API_BASE}/match`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        resume_id: currentResumeId,
                        job_description: jobDesc
                    })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.detail || "匹配分析失败");

                const mr = data.match_result;
                document.getElementById('match-score').textContent = mr.score;

                // Change score color based on value
                const scoreEl = document.getElementById('match-score').parentElement;
                scoreEl.className = `text-center w-16 h-16 rounded-full border-4 flex items-center justify-center bg-white shadow-inner`;
                if (mr.score >= 80) scoreEl.classList.add('border-green-500');
                else if (mr.score >= 60) scoreEl.classList.add('border-blue-500');
                else scoreEl.classList.add('border-red-500');

                document.getElementById('match-score').className = `text-2xl font-black ${mr.score >= 80 ? 'text-green-600' : mr.score >= 60 ? 'text-blue-600' : 'text-red-600'}`;

                document.getElementById('match-skills').textContent = mr.skills_match_rate;
                document.getElementById('match-exp').textContent = mr.experience_relevance;
                document.getElementById('match-comment').textContent = mr.comment;

                document.getElementById('match-result').classList.remove('hidden');

            } catch (err) {
                showToast(err.message);
            } finally {
                matchBtn.classList.remove('hidden');
                document.getElementById('match-loader').classList.add('hidden');
            }
        });

    </script>
</body>

</html>